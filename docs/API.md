# API Reference

This document describes the available API endpoints for the Daily Driver project.

---

## Authentication

Some endpoints require authentication via Sanctum or an API Token. See endpoint details below.

---

## Endpoints

### 1. Get Authenticated User
- **GET** `/api/user`
- **Auth:** Requires `auth:sanctum` (user authentication)
- **Response:**
    - Authenticated user's data (JSON)

### 2. OpenAPI Schema
- **GET** `/api/open-ai/schema`
- **Description:** Returns the OpenAPI 3.1.0 schema for the Todo List API, including endpoint details and schemas.
- **Response:**
    - OpenAPI schema (JSON)

### 3. Search Todo Items
- **GET** `/api/todos`
- **Auth:** Requires `X-API-Token` header (see below)
- **Query Parameters:**
    - `search` (optional): Search term to filter todo items by name or content
- **Response:**
    - Array of todo items (JSON)
    - Each item includes:
        - `id`: integer
        - `name`: string
        - `content`: string
        - `inbox`: boolean
        - `next_action`: boolean
        - `priority_no`: integer
- **Example Request:**
    ```bash
    curl -H "X-API-Token: <your-token>" "https://<your-domain>/api/todos?search=example"
    ```

### 4. Telegram Webhook (Internal)
- **POST** `/api/telegram/dsYeN7rvWz3sGk88X9X4LbQt/webhook`
- **Description:** Receives Telegram bot webhook updates. Not intended for public API use.

---

## Security
- **Sanctum Auth:**
    - Used for `/api/user` endpoint. Requires user to be authenticated (e.g., via SPA or mobile app).
- **API Token:**
    - Used for `/api/todos` endpoint. Provide your API token in the `X-API-Token` header.
    - Example: `X-API-Token: <your-token-here>`

---

## OpenAPI Schema
- The `/api/open-ai/schema` endpoint returns a machine-readable OpenAPI 3.1.0 schema for this API. This can be used for auto-generating documentation or client code.

---

## Post Model Fields Reference

| Field       | Type      | Description                                                                                           | Allowed Values / Example        |
|-------------|-----------|-------------------------------------------------------------------------------------------------------|---------------------------------|
| id          | bigint    | Primary key                                                                                           |                                 |
| title       | string    | Article headline/title                                                                                |                                 |
| content     | text      | Main body of the article                                                                             |                                 |
| slug        | string    | URL-friendly identifier, auto-generated from title                                                    |                                 |
| status      | string    | Editorial workflow state                                                                             | `proposed`, `draft`, `published`, `rejected` |
| source      | string    | How the post was created                                                                             | `manual`, `ai`                  |
| ai_prompt   | text      | (Optional) The prompt/query used to generate an AI-authored article                                   | e.g. "Write about burnout"     |
| published_at| datetime  | When the article was published                                                                       |                                 |
| created_at  | datetime  | When the record was created                                                                          |                                 |
| updated_at  | datetime  | When the record was last updated                                                                     |                                 |
| deleted_at  | datetime  | For soft deletes (if enabled)                                                                        |                                 |

### Field Details
- **status**: Tracks the editorial workflow state of a post. `proposed` (AI-generated, pending review), `draft` (admin editing), `published` (live), `rejected` (not approved for publication).
- **source**: Indicates how the post was created. `manual` (written by a human/admin), `ai` (generated by AI workflow).
- **ai_prompt**: Stores the prompt or query used to generate an AI-authored article. Useful for auditing, reviewing, and debugging AI content.

For further details on usage and workflow, see the [AI-Generated Articles Feature Plan](FEATURE-AI-ARTICLES.md).

---

## Changelog
- 2025-04-17: Initial API documentation created.
